<section class="player-profile">

  <!-- ========================= -->
  <!-- PROFİL YOKSA -->
  <!-- ========================= -->
  <div *ngIf="!profileCompleted && !isEditingProfile" class="empty-profile">
    <h2>Henüz Oyuncu Profilin Yok</h2>
    <p>Maçlara başvurabilmek için önce profilini oluşturmalısın.</p>
    <button class="save-btn" (click)="startCreateProfile()">Profili Oluştur</button>
  </div>

  <!-- ========================= -->
  <!-- PROFİL OLUŞTUR / DÜZENLE -->
  <!-- ========================= -->
  <div *ngIf="isEditingProfile" class="player-create">

    <h1 class="create-title">Oyuncu Profilini Oluştur</h1>

    <div class="create-layout">

      <!-- FORM CARD -->
      <div class="form-card">

        <div class="grid-2">
          <input placeholder="Ad Soyad" [(ngModel)]="profile.fullName" />
          <input type="number" placeholder="Yaş" [(ngModel)]="profile.age" />
        </div>

        <div class="grid-2">
          <input type="number" placeholder="Boy (cm)" [(ngModel)]="profile.heightCm" />
          <input type="number" placeholder="Kilo (kg)" [(ngModel)]="profile.weightKg" />
        </div>

        <div class="grid-2">
          <select [(ngModel)]="profile.city" (change)="onCityChange()">
            <option value="">Şehir Seç</option>
            <option *ngFor="let c of cities" [value]="c">{{ c }}</option>
          </select>

          <select [(ngModel)]="profile.district" [disabled]="!profile.city">
            <option value="">İlçe Seç</option>
            <option *ngFor="let d of districts" [value]="d">{{ d }}</option>
          </select>
        </div>

        <select [(ngModel)]="profile.preferredFoot">
          <option value="">Güçlü Ayak</option>
          <option *ngFor="let f of footOptions" [value]="f">{{ f }}</option>
        </select>

        <textarea
          placeholder="Takımlar / akademiler"
          [(ngModel)]="profile.teamsPlayed">
        </textarea>

      </div>

      <!-- SIDE CARD -->
      <div class="side-card">

        <h3>Pozisyonlar</h3>

        <div class="positions-grid">
          <button
            *ngFor="let pos of positions"
            (click)="togglePosition(pos)"
            [class.active]="profile.positions.includes(pos)">
            {{ pos }}
          </button>
        </div>

        <button class="save-btn" (click)="profileCompleted ? saveEditProfile() : saveProfile()">
          Profili Kaydet
        </button>

        <button *ngIf="profileCompleted" class="mini-btn dark" (click)="cancelEditProfile()">
          Vazgeç
        </button>

      </div>

    </div>
  </div>

  <!-- ========================= -->
  <!-- PROFİL VARSA -->
  <!-- ========================= -->
  <div *ngIf="profileCompleted && !isEditingProfile" class="profile-grid">

    <!-- HERO CARD -->
    <div class="hero-card-wrapper">
      <app-player-hero-card
        [fullName]="profile.fullName"
        [position]="profile.positions.length ? profile.positions[0] : '—'"
        [rating]="82"
        cardTier="silver"
        referencePlayer="Mbappé"
        [isPremium]="isPremium">
      </app-player-hero-card>
    </div>

    <!-- PLAYER INFO -->
    <div class="profile-card">
      <h2>Oyuncu Bilgileri</h2>
      <p><b>Ad:</b> {{ profile.fullName }}</p>
      <p><b>Yaş:</b> {{ profile.age }}</p>
      <p><b>Fizik:</b> {{ profile.heightCm }} / {{ profile.weightKg }}</p>
      <p><b>Mevki:</b> {{ profile.positions.join(', ') }}</p>
      <p><b>Ayak:</b> {{ profile.preferredFoot }}</p>
      <p><b>Lokasyon:</b> {{ profile.city }} / {{ profile.district }}</p>
      <p><b>Takımlar:</b> {{ profile.teamsPlayed || '-' }}</p>

      <button class="mini-btn" (click)="startEditProfile()">Profili Düzenle</button>
    </div>

    <!-- CV -->
    <div class="profile-card">
      <h2>Özgeçmiş</h2>

      <p *ngIf="hasCv && !isEditingCv">{{ cvText }}</p>
      <p *ngIf="!hasCv && !isEditingCv">Henüz özgeçmiş eklenmedi.</p>

      <button *ngIf="!isEditingCv" class="mini-btn" (click)="startEditCv()">Düzenle</button>

      <ng-container *ngIf="isEditingCv">
        <textarea [(ngModel)]="cvText"></textarea>
        <div style="display:flex; gap:8px;">
          <button class="mini-btn yellow" (click)="saveCv()">Kaydet</button>
          <button class="mini-btn dark" (click)="cancelCv()">Vazgeç</button>
        </div>
      </ng-container>
    </div>

    <!-- PHOTOS -->
    <div class="profile-card media-card">
      <h2>Fotoğraflar ({{ photos.length }}/{{ isPremium ? '∞' : '3' }})</h2>

      <div class="media-upload-bar">
        <input type="file" accept="image/*" (change)="onPhotoSelected($event)" />
      </div>

      <div class="media-grid">
        <div class="media-thumb" *ngFor="let p of photos">
          <img [src]="p.url" />
        </div>
      </div>

      <button class="save-btn">Kaydet</button>
    </div>

    <!-- VIDEOS -->
    <div class="profile-card media-card">
      <h2>Videolar ({{ videos.length }}/{{ isPremium ? '∞' : '1' }})</h2>

      <div class="media-upload-bar">
        <input type="file" accept="video/*" (change)="onVideoSelected($event)" />
      </div>

      <div class="media-grid">
        <div class="media-thumb" *ngFor="let v of videos">
          <video [src]="v.url" muted></video>
        </div>
      </div>

      <button class="save-btn">Kaydet</button>
    </div>

  </div> <!-- profile-grid END -->

    <!-- ========================= -->
  <!-- AI ANALYSIS HIGHLIGHT -->
  <!-- ========================= -->
  <div class="ai-highlight-section">

    <h2>AI Performans Analizi</h2>
    <p>
      Videoların ve istatistiklerin yapay zeka ile analiz edilir,
      elit oyuncularla karşılaştırılırsın.
    </p>

    <!-- PREMIUM OPEN -->
    <div class="ai-result-card">
      <p>✅ Premium aktif</p>
      <p>AI analiz ve oyuncu kartı özellikleri açık.</p>

      <button class="save-btn" routerLink="/ai/upload">
  AI Analiz Başlat
</button>

    </div>

  </div>

</section>
